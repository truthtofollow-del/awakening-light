import React, { useState, useEffect } from 'react';
import { Sun, Moon, Wind, CheckCircle, Play, Pause, X } from 'lucide-react';

const TheSanctuary = () => {
  const [timeOfDay, setTimeOfDay] = useState('morning'); // 'morning', 'afternoon', 'evening'
  const [intention, setIntention] = useState('');
  const [isTimerActive, setIsTimerActive] = useState(false);
  const [timeLeft, setTimeLeft] = useState(30 * 60); // 30 minutes in seconds
  const [pledgeProgress, setPledgeProgress] = useState(15); // Example: 15% filled
  const [showQuote, setShowQuote] = useState(true);

  // 1. Determine Time of Day & Dynamic Theme
  useEffect(() => {
    const hour = new Date().getHours();
    if (hour < 12) setTimeOfDay('morning');
    else if (hour < 18) setTimeOfDay('afternoon');
    else setTimeOfDay('evening');

    // Fade out quote after 5 seconds
    const timer = setTimeout(() => setShowQuote(false), 5000);
    return () => clearTimeout(timer);
  }, []);

  // 2. Timer Logic (The Void)
  useEffect(() => {
    let interval = null;
    if (isTimerActive && timeLeft > 0) {
      interval = setInterval(() => {
        setTimeLeft((prev) => prev - 1);
        // Simulate progress filling up as time passes (just for visual demo)
        setPledgeProgress((prev) => Math.min(prev + 0.05, 100)); 
      }, 1000);
    } else if (timeLeft === 0) {
      setIsTimerActive(false);
    }
    return () => clearInterval(interval);
  }, [isTimerActive, timeLeft]);

  // Helper to format time
  const formatTime = (seconds) => {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${m}:${s < 10 ? '0' : ''}${s}`;
  };

  // Theme Config based on Time
  const themes = {
    morning: {
      bg: "bg-gradient-to-b from-orange-50 to-white",
      text: "text-stone-800",
      accent: "text-orange-500",
      greeting: "Rise, Sovereign.",
      prompt: "What are you building today?"
    },
    afternoon: {
      bg: "bg-gradient-to-b from-blue-50 to-white",
      text: "text-slate-800",
      accent: "text-blue-600",
      greeting: "Maintain the Line.",
      prompt: "Stay true to your intention."
    },
    evening: {
      bg: "bg-gradient-to-b from-indigo-900 to-slate-900",
      text: "text-indigo-100",
      accent: "text-indigo-300",
      greeting: "Rest the Mind.",
      prompt: "Did you honor your pledge?"
    }
  };

  const currentTheme = themes[timeOfDay];

  return (
    <div className={`min-h-screen transition-colors duration-1000 ${currentTheme.bg} relative overflow-hidden flex flex-col items-center px-6 pt-12`}>
      
      {/* --- THE VOID OVERLAY (Focus Mode) --- */}
      <div className={`fixed inset-0 bg-black z-50 transition-opacity duration-700 flex flex-col items-center justify-center ${isTimerActive ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}>
        <p className="text-stone-500 text-sm mb-8 animate-pulse">The noise is outside. You are here.</p>
        <h1 className="text-6xl font-thin text-white font-mono tracking-widest">{formatTime(timeLeft)}</h1>
        <button 
          onClick={() => setIsTimerActive(false)}
          className="mt-12 text-stone-600 hover:text-white transition-colors border border-stone-800 rounded-full px-6 py-2 text-xs uppercase tracking-widest"
        >
          Exit the Void
        </button>
      </div>

      {/* --- DAILY WISDOM (Fades Out) --- */}
      <div className={`absolute top-1/3 text-center transition-opacity duration-1000 ${showQuote ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
        <p className={`text-lg font-serif italic ${currentTheme.text} opacity-80`}>"The mind is a fortress. Guard the gates."</p>
        <p className="text-xs uppercase tracking-widest mt-2 opacity-50">â€” Marcus Aurelius</p>
      </div>

      {/* --- HEADER --- */}
      <div className={`w-full max-w-md flex justify-between items-center mb-12 transition-opacity duration-1000 ${showQuote ? 'opacity-0' : 'opacity-100'}`}>
        <div>
          <h1 className={`text-3xl font-light font-serif ${currentTheme.text}`}>{currentTheme.greeting}</h1>
          <p className={`text-sm opacity-60 ${currentTheme.text}`}>{new Date().toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' })}</p>
        </div>
        <div className={`p-3 rounded-full bg-white/10 backdrop-blur-md shadow-sm border border-white/20`}>
           {timeOfDay === 'morning' && <Sun className="w-6 h-6 text-orange-400" />}
           {timeOfDay === 'afternoon' && <Wind className="w-6 h-6 text-blue-400" />}
           {timeOfDay === 'evening' && <Moon className="w-6 h-6 text-indigo-300" />}
        </div>
      </div>

      {/* --- THE PLEDGE RING --- */}
      <div className={`relative mb-12 transition-all duration-1000 ${showQuote ? 'scale-95 opacity-0' : 'scale-100 opacity-100'}`}>
        {/* SVG Ring */}
        <svg className="w-64 h-64 transform -rotate-90">
          <circle
            cx="128"
            cy="128"
            r="120"
            stroke="currentColor"
            strokeWidth="2"
            fill="transparent"
            className="text-stone-200 opacity-20"
          />
          <circle
            cx="128"
            cy="128"
            r="120"
            stroke="currentColor"
            strokeWidth="4"
            fill="transparent"
            strokeDasharray={2 * Math.PI * 120}
            strokeDashoffset={2 * Math.PI * 120 * (1 - pledgeProgress / 100)}
            className={`${currentTheme.accent} transition-all duration-1000 ease-out`}
            strokeLinecap="round"
          />
        </svg>
        
        {/* Center Content */}
        <div className="absolute inset-0 flex flex-col items-center justify-center text-center p-8">
           <span className={`text-4xl font-light ${currentTheme.text}`}>{Math.round(pledgeProgress)}%</span>
           <span className="text-xs uppercase tracking-widest opacity-50 mt-1">Sovereignty</span>
        </div>
      </div>

      {/* --- INTENTION INPUT --- */}
      <div className={`w-full max-w-md space-y-2 mb-8 transition-opacity duration-1000 ${showQuote ? 'opacity-0' : 'opacity-100'}`}>
        <label className={`text-xs uppercase tracking-widest opacity-60 ml-1 ${currentTheme.text}`}>
          {currentTheme.prompt}
        </label>
        <div className="relative">
            <input 
              type="text" 
              value={intention}
              onChange={(e) => setIntention(e.target.value)}
              placeholder="I am focusing on..."
              className="w-full bg-white/50 backdrop-blur-sm border-b border-stone-300 p-4 text-lg focus:outline-none focus:border-stone-500 transition-colors rounded-t-lg"
            />
            {intention && <CheckCircle className="absolute right-4 top-4 w-5 h-5 text-green-500 opacity-50" />}
        </div>
      </div>

      {/* --- ACTION BUTTON (Start Deep Work) --- */}
      <div className={`w-full max-w-md transition-opacity duration-1000 ${showQuote ? 'opacity-0' : 'opacity-100'}`}>
        <button 
          onClick={() => setIsTimerActive(true)}
          className={`w-full group relative overflow-hidden rounded-xl bg-stone-900 p-4 text-white shadow-lg transition-transform active:scale-95`}
        >
          <div className="flex items-center justify-center gap-3 relative z-10">
            <Play className="w-4 h-4 fill-current" />
            <span className="text-sm font-medium tracking-widest uppercase">Enter The Void</span>
          </div>
          {/* Subtle shine effect */}
          <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700" />
        </button>
        <p className="text-center text-xs opacity-40 mt-4">30 Minute Deep Work Session</p>
      </div>

    </div>
  );
};

export default TheSanctuary;
